# Система предметов в диалогах

## Обзор

Система предметов в диалогах позволяет персонажам дарить и просить предметы у игрока, а также получать предметы от персонажей. Система интегрирована с механиками отношений и важных выборов.

## Основные возможности

### 1. Получение предметов от персонажей
Персонажи могут дарить предметы игроку по разным причинам:
- В знак дружбы
- За помощь
- Как награду за важные выборы
- Просто так

**Пример в сценарии:**
```json
{
  "choices": [
    {
      "text": "Принять подарок",
      "nextScene": "scene79",
      "effects": {
        "items": {
          "add": ["gift_box"]
        },
        "relationships": {
          "arseniy": 5
        }
      }
    }
  ]
}
```

### 2. Дарение предметов персонажам
Персонажи могут просить конкретные предметы у игрока. Если у игрока нет нужного предмета, вариант ответа становится неактивным.

**Пример в сценарии:**
```json
{
  "choices": [
    {
      "text": "Дать яблоко",
      "nextScene": "scene81",
      "requiredItem": "apple",
      "effects": {
        "items": {
          "remove": ["apple"]
        },
        "relationships": {
          "arseniy": 8
        }
      }
    }
  ]
}
```

### 3. Требования к отношениям
Некоторые выборы доступны только при определенном уровне отношений:

**Пример в сценарии:**
```json
{
  "choices": [
    {
      "text": "Конечно! Что ты можешь подарить?",
      "nextScene": "scene89",
      "requiredRelationship": {
        "arseniy": "friendship"
      }
    }
  ]
}
```

## Уровни отношений

Система поддерживает следующие уровни отношений:
- `hostile` (0-19) - Враждебность
- `stranger` (20-39) - Незнакомец
- `neutral` (40-59) - Нейтральные отношения
- `acquaintance` (60-79) - Знакомство
- `friendship` (80-99) - Дружба
- `love` (100+) - Любовь

## Уведомления

При получении или изъятии предметов автоматически показываются уведомления:
- "Получен предмет [название предмета]"
- "Изъят предмет [название предмета]"

## Новые предметы

### Подарок (present)
- **Тип:** consumable
- **Редкость:** common
- **Описание:** Загадочный подарок с сюрпризом внутри. Всегда приятно получить
- **Цена:** 15 монет

### Фея (fairy)
- **Тип:** pet
- **Редкость:** rare
- **Описание:** Магическое существо
- **Цена:** 150 монет

## Техническая реализация

### Файлы системы
- `src/utils/dialogueItemSystem.js` - Основная логика обработки предметов
- `src/utils/episodeManager.js` - Интеграция с менеджером эпизодов
- `src/components/screens/GameScreen.js` - UI для отображения выборов

### Ключевые функции

#### `processChoiceEffects(choice, gameState, updateInventory, updateRelationships, showNotification)`
Обрабатывает эффекты выбора, включая предметы и отношения.

#### `isChoiceAvailable(choice, inventory)`
Проверяет доступность выбора на основе требуемых предметов.

#### `getRelationshipLevel(relationshipValue)`
Определяет уровень отношений по числовому значению.

#### `checkRelationshipRequirement(requiredRelationship, currentRelationships)`
Проверяет, достигнут ли требуемый уровень отношений.

### Интеграция с существующими системами

#### Инвентарь
Система интегрирована с `InventoryContext` для управления предметами игрока.

#### Отношения
Использует `RelationshipsContext` для управления отношениями между персонажами.

#### Уведомления
Интегрирована с `NotificationContext` для показа уведомлений о предметах.

## Примеры использования

### Сцена с дарением предмета
```json
{
  "id": "scene77",
  "chapterId": 6,
  "dialogue": [
    {
      "speaker": "arseniy",
      "text": "Вот, например, я хочу подарить тебе небольшой подарок в знак нашего знакомства!",
      "emotion": "delighted"
    }
  ],
  "choices": [
    {
      "text": "Принять подарок",
      "nextScene": "scene79",
      "effects": {
        "items": {
          "add": ["present"]
        },
        "relationships": {
          "arseniy": 5
        }
      }
    }
  ]
}
```

### Сцена с запросом предмета
```json
{
  "id": "scene78",
  "chapterId": 6,
  "dialogue": [
    {
      "speaker": "arseniy",
      "text": "Можешь ли ты дать мне яблоко? Я очень хочу перекусить.",
      "emotion": "normal"
    }
  ],
  "choices": [
    {
      "text": "Конечно, вот твоё яблоко!",
      "nextScene": "scene81",
      "requiredItem": "apple",
      "effects": {
        "items": {
          "remove": ["apple"]
        },
        "relationships": {
          "arseniy": 10
        }
      }
    }
  ]
}
```

### Сцена с требованием отношений
```json
{
  "id": "scene85",
  "chapterId": 6,
  "choices": [
    {
      "text": "Конечно! Что ты можешь подарить?",
      "nextScene": "scene89",
      "requiredRelationship": {
        "arseniy": "friendship"
      }
    }
  ]
}
```

## Тестирование

Для тестирования системы создана страница `test_chapter6.html`, которая позволяет:
- Имитировать инвентарь игрока
- Тестировать различные сцены
- Проверять логику доступности выборов
- Отслеживать уведомления

## Будущие улучшения

1. **Система крафта** - Создание предметов из материалов
2. **Качество предметов** - Редкие, эпические, легендарные версии
3. **Временные эффекты** - Предметы с временными бонусами
4. **Коллекции** - Система сбора наборов предметов
5. **Торговля** - Обмен предметами между игроками 